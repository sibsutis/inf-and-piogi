---
title: SQL запросы
---
## Определение.

SQL (Structured Query Language - язык структурированных запросов) — это язык запросов для управления реляционными базами данных. 
«Реляционные» означает, что все данные хранятся в виде взаимосвязанных таблиц. А SQL как раз используют для того, чтобы взаимодействовать с элементами внутри этих таблиц: добавлять, удалять, изменять и так далее.

## Основные компоненты таблицы.

- **Таблица (Table):** Основной объект хранения данных. Похожа на лист в Excel. Например, таблица Students (Студенты) или Books (Книги). Хранит **столбцы** и **строки**. Пересечение **столбцов** и **строк** - **ячейка**.
- **Столбец (Column / Attribute):** Определяет тип данных, которые хранятся в таблице (например, FirstName, LastName, StudentID, EnrollmentYear). У каждого столбца есть имя и тип данных (текст, число, дата и т.д.).
- **Строка (Row / Record):** Представляет собой одну запись в таблице (например, информация об одном конкретном студенте). *Можно представить, что это объект класса.*
- **Ячейка (Cell):** Пересечение строки и столбца, содержит конкретное значение (например, имя "Иван" в столбце FirstName для одной из строк).

**Пример фрагмента таблицы Students:**

| StudentID | FirstName | LastName | Major       | EnrollmentYear |
| --------- | --------- | -------- | ----------- | -------------- |
| 101       | Иван      | Иванов   | Информатика | 2022           |
| 102       | Мария     | Петрова  | История     | 2023           |
| 103       | Алексей   | Сидоров  | Информатика | 2022           |
| 104       | Елена     | Смирнова | Биология    | 2021           |

## Основные команды SQL (CRUD - Create, Read, Update, Delete).

#### **Create Table**

Прежде чем мы сможем добавлять (`INSERT`) или извлекать (`SELECT`) данные, нам нужна сама таблица! Команда `CREATE TABLE` используется для определения новой таблицы, ее столбцов и типов данных, которые эти столбцы будут хранить.

- **Основные компоненты:**
	- `CREATE TABLE` имя_таблицы: Начинает определение таблицы.
	- ( ... ): В скобках перечисляются определения столбцов.
	- имя_столбца `ТИП_ДАННЫХ` `[ограничения]`: Каждый столбец определяется своим именем, типом данных и необязательными ограничениями.
- **[Распространенные типы данных:](../../topics/db-browser-info#_2)**
	- `INT` или `INTEGER`: Целые числа (например, 101, 2023).
	- `VARCHAR`(n): Текстовая строка переменной длины, где n — максимальное количество символов (например, VARCHAR(50) для имени).
	- `TEXT`: Длинный текст без фиксированного ограничения длины (зависит от СУБД).
	- `DATE`: Дата (например, '2023-10-27').
	- `DECIMAL`(p, s) или `NUMERIC`(p, s): Числа с фиксированной точностью (например, для цен), где p - общее число цифр, s - число цифр после запятой.
	- `BOOLEAN`: Логическое значение (Истина/Ложь).
- **[Распространенные ограничения (Constraints):](../../topics/db-browser-info#_3)**
	- `NOT NULL`: Значение в этом столбце не может быть пустым (null).
	- `UNIQUE`: Все значения в этом столбце должны быть уникальными.
	- `PRIMARY KEY`: Комбинация NOT NULL и UNIQUE. Используется для однозначной идентификации каждой строки в таблице (как `StudentID` в нашем примере). Обычно у таблицы есть один первичный ключ.

#### **Синтаксис**

```sql
CREATE TABLE имя_таблицы (
    столбец1 ТИП_ДАННЫХ [ограничения],
    столбец2 ТИП_ДАННЫХ [ограничения],
    столбец3 ТИП_ДАННЫХ [ограничения],
    ...
    [PRIMARY KEY (имя_столбца_ключа)] -- Один из способов задать первичный ключ
);
```

### **Пример**

**Создадим нашу таблицу Students:**
```sql
CREATE TABLE Students (
    StudentID INT PRIMARY KEY,       -- Целое число, первичный ключ (уникальный, не null)
    FirstName TEXT NOT NULL, -- Длинный текст, не может быть пустой
    LastName TEXT NOT NULL,  -- Длинный текст, не может быть пустой
    Major TEXT,             -- Длинный текст (может быть null, если студент еще не выбрал)
    EnrollmentYear INT              -- Год поступления (целое число)
);
```

Теперь, когда у нас есть структура (`CREATE TABLE`), мы можем наполнять ее данными (`INSERT INTO`) и задавать ей вопросы (`SELECT`).
### Read from Table

Мы начнем с самой часто используемой операции — **чтения (Read)** данных.

- **SELECT**: Используется для **выборки** данных из одной или нескольких таблиц. Это ваш основной инструмент для "задавания вопросов" базе данных.
- **FROM**: Указывает, **из какой таблицы** вы хотите получить данные.

### **Базовый синтаксис**

```sql
SELECT столбец1, столбец2, ... FROM имя_таблицы;
```

### **Примеры**

- **Выбрать ВСЕ столбцы и ВСЕ строки из таблицы Students:**  
Звездочка * означает "все столбцы".

```sql
SELECT * FROM Students;
```

Результат: Вся таблица `Students`, показанная выше.

- **Выбрать только Имена и Фамилии всех студентов:**

```sql
SELECT FirstName, LastName FROM Students;
```

Результат:  

| FirstName | LastName |
| :-------- | :------- |
| Иван      | Иванов   |
| Мария     | Петрова  |
| Алексей   | Сидоров  |
| Елена     | Смирнова |

## **Фильтрация данных (WHERE)**

Часто вам нужны не все строки, а только те, которые соответствуют определенному условию. Для этого используется WHERE.

- **WHERE**: Фильтрует строки на основе заданного условия.

### **Синтаксис**
```sql
SELECT столбец1, столбец2, ... FROM имя_таблицы WHERE условие;
```

### **Примеры**

- **Найти всех студентов специальности "Информатика":** 

**Обратите внимание:** текстовые значения (строки) обычно заключаются в одинарные кавычки `' '`.

```sql
SELECT * FROM Students WHERE Major = 'Информатика';
```

Результат:  

| StudentID | FirstName | LastName | Major       | EnrollmentYear |
| :-------- | :-------- | :------- | :---------- | :------------- |
| 101       | Иван      | Иванов   | Информатика | 2022           |
| 103       | Алексей   | Сидоров  | Информатика | 2022           |

- **Найти студентов, поступивших после 2021 года:** 

Числовые значения кавычек не требуют.

```sql
SELECT FirstName, LastName, EnrollmentYear FROM Students WHERE EnrollmentYear > 2021;
```

Результат: 

| FirstName | LastName | EnrollmentYear |  
| :-------- | :------- | :------------- |  
| Иван | Иванов | 2022 |  
| Мария | Петрова | 2023 |  
| Алексей | Сидоров | 2022 |

**Комбинирование условий (AND, OR):**

- **AND**: Оба условия должны быть истинными.
- **OR**: Хотя бы одно из условий должно быть истинным.

**Найти студентов-историков ИЛИ студентов, поступивших в 2022 году:**

```sql
SELECT * FROM Students WHERE Major = 'История' OR EnrollmentYear = 2022;
```

## **Сортировка результатов (ORDER BY)**

Чтобы представить результаты в определенном порядке (например, по алфавиту или по дате).

- **ORDER BY**: Сортирует строки результата.
- **ASC**: По возрастанию (Ascending) - используется по умолчанию, если не указано иное.
- **DESC**: По убыванию (Descending).

### **Синтаксис**

```sql
SELECT столбец1, столбец2, ... FROM имя_таблицы WHERE условие -- (Необязательно) ORDER BY столбец_для_сортировки [ASC | DESC];
```

### **Примеры**

- **Вывести всех студентов, отсортированных по Фамилии в алфавитном порядке:**

```sql
SELECT * FROM Students ORDER BY LastName ASC; -- ASC можно опустить, т.к. это по умолчанию
```

- **Вывести всех студентов, отсортированных по году поступления (сначала самые новые):**

```sql
SELECT * FROM Students ORDER BY EnrollmentYear DESC;
```


## **Объединение таблиц (JOIN)**

Часто нужная информация хранится не в одной, а в **нескольких связанных таблицах**. Например, у нас может быть таблица `Students` и отдельная таблица `Enrollments` (Зачисления на курсы), где указано, какие студенты на какие курсы записаны.

- **Таблица Students (уже знакомая):** 

| StudentID | FirstName | LastName | ... |     |
| :-------- | :-------- | :------- | :-- | --- |
| 101       | Иван      | Иванов   | ... |     |
| 102       | Мария     | Петрова  | ... |     |
| 103       | Алексей   | Сидоров  | ... |     |

- **Пример таблицы Enrollments:** 

| EnrollmentID | StudentID | CourseName | Semester |  
| :----------- | :-------- | :-------------- | :------- |  
| 1 | 101 | Введение в SQL | Осень 2023 |  
| 2 | 102 | История Др. Рима | Осень 2023 |  
| 3 | 101 | Алгоритмы | Весна 2024 |  
| 4 | 103 | Введение в SQL | Осень 2023 |


Видите столбец StudentID в обеих таблицах? Это **ключ**, по которому мы можем связать студента с его курсами.

- **JOIN**: Оператор, который комбинирует строки из двух или более таблиц на основе связанного столбца между ними.
- **INNER JOIN**: Возвращает только те строки, для которых **есть совпадение** в обеих таблицах по указанному условию связи.

### **Базовый синтаксис**

```sql
SELECT
    t1.столбец1,
    t1.столбец2,
    t2.столбец_a,
    t2.столбец_b
FROM
    таблица1 t1 -- t1 - это псевдоним для краткости
INNER JOIN
    таблица2 t2 -- t2 - псевдоним
ON
    t1.ключевой_столбец = t2.ключевой_столбец; -- Условие связи таблиц
```

### **Пример**

**Вывести Имя, Фамилию студента и название курса, на который он записан:**

```sql
SELECT
    s.FirstName,  -- Берем FirstName из таблицы Students (псевдоним s)
    s.LastName,   -- Берем LastName из таблицы Students
    e.CourseName  -- Берем CourseName из таблицы Enrollments (псевдоним e)
FROM
    Students s    -- Наша первая таблица с псевдонимом s
INNER JOIN
    Enrollments e -- Присоединяем вторую таблицу с псевдонимом e
ON
    s.StudentID = e.StudentID; -- Условие: ID студента должны совпадать
```

Результат (примерный):  

| FirstName | LastName | CourseName       |
| :-------- | :------- | :--------------- |
| Иван      | Иванов   | Введение в SQL   |
| Мария     | Петрова  | История Др. Рима |
| Иван      | Иванов   | Алгоритмы        |
| Алексей   | Сидоров  | Введение в SQL   |

`JOIN` позволяет собирать комплексную информацию из разных частей вашей базы данных. Это ключевой навык для работы с реляционными БД. Есть и другие типы `JOIN` (`LEFT JOIN`, `RIGHT JOIN`, `FULL OUTER JOIN`), но `INNER JOIN` — отличная точка для старта.

## Операции вставки и обновления

### **INSERT INTO**

- Добавляет новые строки (записи) в таблицу.

```sql
INSERT INTO Students (StudentID, FirstName, LastName, Major, EnrollmentYear) VALUES (105, 'Петр', 'Петров', 'Физика', 2023);
```

**Обратите внимание:** если у поля, отвечающего за [первичный ключ (Primary Key)](../../topics/db-browser-info#_3) включено свойство [Авто Инкремент (Auto Increment)](../../topics/db-browser-info#_3) - это поле в запросе нужно пропустить:

```sql
INSERT INTO Students (FirstName, LastName, Major, EnrollmentYear) VALUES ('Петр', 'Петров', 'Физика', 2023);
```

### **UPDATE**

- Изменяет существующие данные в таблице. 
- **Осторожно!** Всегда используйте WHERE, чтобы не изменить лишнего.

```sql
UPDATE Students SET Major = 'Прикладная информатика' WHERE StudentID = 101;
```

### **DELETE FROM** 
- Удаляет строки из таблицы. 
- **Очень осторожно!** Всегда используйте WHERE, чтобы не удалить все данные!
<del>Даже Димка Фокин иногда роняет прод из-за этой команды.</del>

```sql
DELETE FROM Students WHERE StudentID = 105;
```

### **Самая крутая штука: DROP TABLE**

Она удаляет ВСЮ таблицу — структуру, данные, всё. Навсегда. Безвозвратно.

```sql
-- ВЫПОЛНЯЙТЕ ЭТУ КОМАНДУ ТОЛЬКО ПЕРЕД СДАЧЕЙ ЛАБЫ 
-- DROP TABLE Students;
```

## **Ключевые моменты и синтаксис.**

- SQL команды обычно пишут **ЗАГЛАВНЫМИ БУКВАМИ** (SELECT, FROM, WHERE), а имена таблиц и столбцов — как они определены (часто CamelCase или snake_case). Сам язык обычно нечувствителен к регистру, но это хорошее правило для читаемости.
- Строки запроса часто заканчиваются точкой с запятой `;`. Во многих инструментах она обязательна.
- Текстовые значения заключаются в одинарные кавычки (`'текст'`).
- Числа пишутся без кавычек (`123`, `2023`).

