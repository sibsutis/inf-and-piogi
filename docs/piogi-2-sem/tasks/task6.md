---
title: "ТЗ: Лабораторная работа 6 — POST & Booking"
---

# Лабораторная работа 6

## Краткое описание

Финальная лаба: реализация бронирования билетов через POST-запрос, обработка ответов сервера, отображение билета.

---

## Обязательные требования

### 1. POST-запрос бронирования
- [ ] Реализован метод `CreateBookingAsync` в ApiService
- [ ] Запрос отправляется в формате JSON
- [ ] Используется `HttpClient.PostAsync`

### 2. Модели данных
- [ ] Создан `BookingRequest` (SessionId, Seats)
- [ ] Создан `BookingResponse` (Success, BookingId, QrCodeUrl, ErrorMessage)

### 3. Обработка ответов сервера
- [ ] 200 OK — переход на страницу билета
- [ ] 409 Conflict — сообщение "Место занято", обновление карты
- [ ] 400 Bad Request — сообщение об ошибке
- [ ] Ошибка сети — корректная обработка (try-catch)

### 4. Страница билета
- [ ] Создана страница `TicketPage`
- [ ] Отображается номер брони
- [ ] Отображается QR-код (или placeholder)
- [ ] Есть кнопка "На главную"

### 5. Навигация
- [ ] Реализован полный user flow: Фильмы → Сеанс → Зал → Билет
- [ ] Используется `Frame` или `NavigationService`

### 6. UX
- [ ] Кнопка "Купить" блокируется во время запроса
- [ ] Показывается индикатор загрузки
- [ ] Приложение не крашится при ошибках

---

## Git-воркфлоу

| Этап | Действие |
|------|----------|
| Начало | `git checkout -b feature/lab-6-booking` |
| Коммиты | `feat: add booking request`, `feat: add ticket page` |
| Финал | Pull Request в `main` |

---

## Критерии оценивания

| Ранг | Требования |
|------|------------|
| **SILVER** | Бронирование работает, ошибки обрабатываются без крашей |
| **GOLD** | Корректная обработка всех HTTP-кодов, индикатор загрузки, чистый код |
| **PLATINUM** | Анимации переходов, кеширование данных, retry при ошибках сети |

---

## API Endpoints

### POST /api/booking

**Request:**
```json
{
  "sessionId": 1,
  "seats": [
    { "row": 3, "number": 5 },
    { "row": 3, "number": 6 }
  ]
}
```

**Response (200 OK):**
```json
{
  "success": true,
  "bookingId": "BK-2024-001234",
  "qrCodeUrl": "https://api.../qr/BK-2024-001234.png"
}
```

**Response (409 Conflict):**
```json
{
  "success": false,
  "errorMessage": "Seats already booked"
}
```

---

## HTTP-коды и действия

| Код | Значение | Действие |
|-----|----------|----------|
| 200 OK | Успех | Показать билет (QR) |
| 409 Conflict | Место занято | "Место уже занято кем-то другим" |
| 400 Bad Request | Ошибка запроса | Показать сообщение об ошибке |
| 500+ | Ошибка сервера | "Попробуйте позже" |

---

## Полный User Flow

```
[Список фильмов] → [Детали фильма] → [Выбор сеанса] 
      ↓
[Карта зала] → [Выбор мест] → [Купить]
      ↓
[Обработка запроса]
      ↓
[Успех] → [Страница билета] → [На главную]
[Ошибка] → [Сообщение] → [Карта зала]
```

---

## Технические ограничения

- Не хранить данные билетов локально (только в памяти)
- Обязательно обрабатывать все возможные ошибки
- Кнопка "Купить" должна быть неактивна при пустом выборе

---

## Критерий сдачи

1. Приложение запускается
2. Полный путь: выбор фильма → сеанса → мест → бронирование → билет
3. При ошибке 409 показывается сообщение (не краш)
4. При ошибке сети показывается сообщение (не краш)
5. На странице билета отображается QR-код и номер брони
6. Pull Request создан и готов к ревью

---

## Поздравляю!

Если ты дошёл до этой лабы и сдал её — у тебя есть полноценное WPF-приложение с:

- HTTP-клиентом
- Data Binding
- Кастомными компонентами
- Стилизацией и темами
- Полным user flow

Это уже портфолио-проект!

